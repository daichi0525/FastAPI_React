# Excelのマクロでwbsの内容を元に一筆書きのイナズマ線の図形を描きたい。

セルa1:*プロジェクト開始日
セルa2:*プロジェクト終了日
セルa3:*今日の日付(集計日)
セルa10〜セルg10:*計画開始日、*計画日数、*計画終了日、実績開始日、実績日数、実績終了日、進捗率のそれぞれタイトル名
セルa11〜セルg50:*計画開始日、*計画日数、*計画終了日、実績開始日、実績日数、実績終了日、進捗率のそれぞれの値
セルh10〜セルBZ10:*プロジェクト開始日以降の日付
セルh10〜セルBZ50:イナズマ線を描きたい
*の印は既に値が入っています。
マクロを実行するたびに前回の図形は削除したい。セルa3を基準日にしたい。
遅れている場合は計画開始日を0%計画終了日を100%の範囲とし進捗率を元にイナズマ線を描きたい。逆に進んでいる場合は計画開始日を0%計画終了日を100%の範囲とし進捗率を元にイナズマ線を描きたい。
オンスケの場合は線が縦にまっすぐなるはずで、先の予定のものは基準日でまっすぐなるはずです。
セルの縦と横の中央が頂点として下さい。
ではマクロを書いて下さい。


# 以下に、指定された条件に基づいてExcelマクロを作成しました。このマクロは、セルの内容に基づいてイナズマ線を描画し、前回の図形を削除します。

```vba
Sub DrawLightningBolt()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets(1) ' シート名に合わせて変更してください

    ' 前回の図形を削除
    Dim shp As Shape
    For Each shp In ws.Shapes
        If shp.Type = msoLine Then
            shp.Delete
        End If
    Next shp

    ' データの取得
    Dim projectStartDate As Date
    Dim projectEndDate As Date
    Dim todayDate As Date
    projectStartDate = ws.Range("A1").Value
    projectEndDate = ws.Range("A2").Value
    todayDate = ws.Range("A3").Value

    Dim row As Integer
    For row = 11 To 50
        Dim planStartDate As Date
        Dim planEndDate As Date
        Dim actualStartDate As Date
        Dim actualEndDate As Date
        Dim progress As Double

        planStartDate = ws.Cells(row, 1).Value
        planEndDate = ws.Cells(row, 3).Value
        actualStartDate = ws.Cells(row, 4).Value
        actualEndDate = ws.Cells(row, 6).Value
        progress = ws.Cells(row, 7).Value

        Dim startX As Integer, startY As Integer, endX As Integer, endY As Integer

        startX = DateDiff("d", projectStartDate, planStartDate) + 8 ' 開始日からの差をX座標に変換
        endX = DateDiff("d", projectStartDate, planEndDate) + 8

        If actualEndDate < todayDate Then ' 遅れている場合
            startY = (row - 11) * 20 + 10 ' Y座標の開始点を計算
            endY = startY + 20
            ws.Shapes.AddLine ws.Cells(row, startX).Left, ws.Cells(row, startY).Top, ws.Cells(row, endX).Left, ws.Cells(row, endY).Top
        Else ' 進んでいる場合またはオンスケの場合
            startY = (row - 11) * 20 + 10
            endY = startY + 20 * progress ' 進捗率に応じたY座標
            ws.Shapes.AddLine ws.Cells(row, startX).Left, ws.Cells(row, startY).Top, ws.Cells(row, endX).Left, ws.Cells(row, endY).Top
        End If
    Next row
End Sub
```

このマクロは、指定されたセル範囲に基づいてイナズマ線を描画し、前回の図形を削除します。プロジェクト開始日からの日数をX座標として計算し、行ごとに進捗率に応じてY座標を計算してイナズマ線を描画します。線の始点と終点は、計画開始日と計画終了日を基準に設定されています。
