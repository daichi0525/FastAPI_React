Sub DrawLightningBolt()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets(1) ' シート名に合わせて変更してください

    ' 前回の図形を削除
    Dim shp As Shape
    For Each shp In ws.Shapes
        If shp.Type = msoFreeform Then
            shp.Delete
        End If
    Next shp

    ' データの取得
    Dim projectStartDate As Date
    Dim projectEndDate As Date
    Dim todayDate As Date
    projectStartDate = ws.Range("A1").Value
    projectEndDate = ws.Range("A2").Value
    todayDate = ws.Range("A3").Value

    Dim row As Integer
    For row = 11 To 50
        Dim planStartDate As Date
        Dim planEndDate As Date
        Dim actualStartDate As Date
        Dim actualEndDate As Date
        Dim progress As Double

        planStartDate = ws.Cells(row, 1).Value
        planEndDate = ws.Cells(row, 3).Value
        actualStartDate = ws.Cells(row, 4).Value
        actualEndDate = ws.Cells(row, 6).Value
        progress = ws.Cells(row, 7).Value

        Dim startX As Integer, startY As Integer, midX As Integer, midY As Integer, endX As Integer, endY As Integer

        startX = DateDiff("d", projectStartDate, planStartDate) + 8 ' 開始日からの差をX座標に変換
        endX = DateDiff("d", projectStartDate, planEndDate) + 8

        If actualEndDate < todayDate Then ' 遅れている場合
            startY = (row - 11) * 20 + 10 ' Y座標の開始点を計算
            midY = startY + 20 * progress ' 進捗率に応じた中間点Y座標
            endY = startY + 20 ' 終了点Y座標
        Else ' 進んでいる場合またはオンスケの場合
            startY = (row - 11) * 20 + 10
            midY = startY + 20 * progress
            endY = midY
        End If

        ' 折れ線の描画
        Dim shape As Shape
        Set shape = ws.Shapes.AddShape(msoShapeFreeform, ws.Cells(row, startX).Left, ws.Cells(row, startY).Top, 0, 0)
        With shape
            .Line.Visible = msoTrue
            .Line.Weight = 2
            .Nodes.Add NodeType:=msoSegmentLine, EditingType:=msoEditingCorner, X1:=ws.Cells(row, startX).Left, Y1:=ws.Cells(row, startY).Top
            .Nodes.Add NodeType:=msoSegmentLine, EditingType:=msoEditingCorner, X1:=ws.Cells(row, midX).Left, Y1:=ws.Cells(row, midY).Top
            .Nodes.Add NodeType:=msoSegmentLine, EditingType:=msoEditingCorner, X1:=ws.Cells(row, endX).Left, Y1:=ws.Cells(row, endY).Top
        End With
    Next row
End Sub
