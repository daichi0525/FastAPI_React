Sub DrawLightningBolt()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets(1) ' シート名に合わせて変更してください

    ' 前回の図形を削除
    Dim shp As Shape
    For Each shp In ws.Shapes
        If shp.Type = msoLine Then
            shp.Delete
        End If
    Next shp

    ' データの取得
    Dim projectStartDate As Date
    Dim projectEndDate As Date
    Dim todayDate As Date
    projectStartDate = ws.Range("A1").Value
    projectEndDate = ws.Range("A2").Value
    todayDate = ws.Range("A3").Value

    Dim row As Integer
    For row = 11 To 50
        Dim planStartDate As Date
        Dim planEndDate As Date
        Dim actualStartDate As Date
        Dim actualEndDate As Date
        Dim progress As Double

        planStartDate = ws.Cells(row, 1).Value
        planEndDate = ws.Cells(row, 3).Value
        actualStartDate = ws.Cells(row, 4).Value
        actualEndDate = ws.Cells(row, 6).Value
        progress = ws.Cells(row, 7).Value

        Dim startX As Integer, startY As Integer, endX As Integer, endY As Integer

        startX = DateDiff("d", projectStartDate, planStartDate) + 8 ' 開始日からの差をX座標に変換
        endX = DateDiff("d", projectStartDate, planEndDate) + 8

        If actualEndDate < todayDate Then ' 遅れている場合
            startY = (row - 11) * 20 + 10 ' Y座標の開始点を計算
            endY = startY + 20
            ws.Shapes.AddLine ws.Cells(row, startX).Left, ws.Cells(row, startY).Top, ws.Cells(row, endX).Left, ws.Cells(row, endY).Top
        Else ' 進んでいる場合またはオンスケの場合
            startY = (row - 11) * 20 + 10
            endY = startY + 20 * progress ' 進捗率に応じたY座標
            ws.Shapes.AddLine ws.Cells(row, startX).Left, ws.Cells(row, startY).Top, ws.Cells(row, endX).Left, ws.Cells(row, endY).Top
        End If
    Next row
End Sub
